Specifications
==============

Inputs
------
- Test data
- Trained model
- Hierarchy over features

Outputs
-------
- CSV, listing for all nodes in hierarchy:
    - Accuracy of model with given node perturbed
    - p-values of paired statistical test comparing perturbed model loss to baseline (unperturbed) model loss

Client API
----------

### Data types
The library deals with models that accept one or both of the following types of input:
- **Static input**: Represented as a single vector per instance of length *L*
- **Temporal input**: Represented as an input sequence of variable length *V*, each element of which is a vector of fixed length *W*.

Models commonly take only static input, but models such as Recurrent Neural Networks (RNNs) work with input sequences. Models comprising bigger networks with RNN sub-networks may take both kinds of inputs.

### Data representation
The data must be in [HDF5](https://support.hdfgroup.org/HDF5/) format, which (among other things) allows easy storage and access of a combination of static and variable-length temporal data. The recommended method of generating HDF5 inputs is via [h5py](http://docs.h5py.org/en/latest/index.html).

HDF5 data is organized into a hierarchy comprising groups (containers) and datasets (data collections).
The input data for *mihifepe* must be organized as follows (see [TODO] for examples).

Groups:

    /records
    /records/<record_id>

Datasets:

    /records/<record_id>/temporal (2-D array)
    /records/<record_id>/static (1-D array)
    /records/<record_id>/target (scalar)

Sparse representations may be used for both temporal and static data, in which case the attribute 'sparse' must be specified (see above example).

### Trained model
The client must create a *model* object, corresponding to the trained model, that implements the following method:

    model.predict(target, input_vector=None, input_sequence=None)

which must return a tuple (loss, prediction) representing the model's output loss and prediction
for the given (target, instance) pair.

This object must be generated by a standalone Python script that is passed to *mihifepe*. This allows *mihifepe* to distribute the feature perturbations across multiple workers, each with its own copy of *model*. For instance, if the script path is */a/b/c/d/gen_model.py*, then *mihifepe* will access *model* as follows:

    sys.path.insert(0, "/a/b/c/d/") # Makes python search this folder for modules
    from gen_model import model

The test data type must match the data type of the *predict* function (e.g. if the model requires both static and temporal input, the input test data must provide both for every instance).

### Hierarchy over features
The client must provide a hierarchy over features as a CSV file. Each node (including leaf nodes) may correspond to a single feature or a group of features. If both static and temporal data exist, they cannot be part of the same leaf node.

    *name*:             unique identifier string
    *parent_name*:      node_name of parent if it exists, else '' (root node)
    *description*:      node description
    *data_type*:        [only required for leaf nodes] 'static' or 'temporal'
    *indices*:          [only required for leaf nodes] list of tab-separated indices
                        corresponding to the indices of these features in the data

Input files
-----

- (Test data): *data_filename*: Test data in HDF5 format
- (Trained model): *model_generator_filename*: Python script that generates model object for subsequent callbacks to model.predict
- (Hierarchy over features): *hierarchy_filename*: CSV specifying hierarchy over features

Examples
--------
[TODO]
